name = "node-metrics"

[[services]]
  name = "agent"
  image = "docker.io/prom/prometheus:latest"
  [services.process]
    args = [
      "/bin/prometheus",
      "--enable-feature=agent",
      "--config.file=/etc/prometheus/prometheus.yml",
    ]
  [services.placementPreference]
    strategy = "global"
  [services.network]
    type = "stellar"
  [[services.configs]]
    name = "prometheus"
    path = "/etc/prometheus/prometheus.yml"
    content = '''# managed by stellar
global:
  scrape_interval: 15s
  external_labels:
    agent: {{ .Agent.Name }}

scrape_configs:
  - job_name: "containerd"
    metrics_path: /v1/metrics
    static_configs:
      - targets: ["{{ .Agent.AgentIP }}:10000"]

remote_write:
- url: 'http://prometheus:9090/api/v1/write'
'''
